<!-- CptS 489, Spring 2019
     Project: Task Tracker
     File: navbar.html
     This file contains the definition of the navbar that is used throughout the webapp.
-->
<nav class="nav bg-dark" id="navbar">
    <div class="nav-large">
        <ul class="nav">
            <li class="nav-item bg-primary logged-out" style='display:none;'>
                <a class="nav-link text-white nav-large" href="" id="nav-home">
                    <i class="fas fa-check-double"></i>&nbsp;
                    Achiever
                </a>
            </li>
            <li class="nav-item bg-primary logged-in">
                <a class="nav-link text-white nav-large" href="tasklist" id="nav-tasklist">
                    <i class="fas fa-check-double"></i>&nbsp;
                    Tasks
                </a>
            </li>
            <li class="nav-item logged-in">
                <a class="nav-link text-white nav-large" href="schedule" id="nav-schedule">
                    <!-- <i class="fas fa-calendar"></i>&nbsp; -->
                    Schedule
                </a>
            </li>
            <li class="nav-item logged-in">
                <a class="nav-link text-white nav-large" href="progress" id="nav-progress">
                    <!-- <i class="fas fa-tasks"></i>&nbsp; -->
                    Progress
                </a>
            </li>
            <li class="nav-item logged-in">
                <a class="nav-link text-white nav-large" href="achievements" id="nav-achievements">
                    <!-- <i class="fas fa-trophy"></i>&nbsp; -->
                    Achievements
                </a>
            </li>
        </ul>
    </div>

    <div class="nav-smol" style="width:100%">
        <div class="pos-f-t">
            <div class="collapse" id="navbarToggleExternalContent">
                <div class="nav-item bg-dark">
                    <a class="nav-link text-white bg-primary" href="tasklist" id="nav-tasklist"><i
                            class="fas fa-check-double"></i>&nbsp;Tasks</a>
                    <a class="nav-link text-white" href="schedule" id="nav-schedule"><i
                            class="fas fa-calendar"></i>&nbsp;Schedule</a>
                    <a class="nav-link text-white" href="progress" id="nav-progress"><i
                            class="fas fa-tasks"></i>&nbsp;Progress</a>
                    <a class="nav-link text-white" href="achievements" id="nav-achievements"><i
                            class="fas fa-trophy"></i>&nbsp;Achievements</a>
                </div>
            </div>
            <nav class="navbar navbar-dark bg-dark">
                <button class="navbar-toggler" type="button" data-toggle="collapse"
                    data-target="#navbarToggleExternalContent" aria-controls="navbarToggleExternalContent"
                    aria-expanded="false" aria-label="Toggle navigation">
                    <span class="fas fa-bars text-white" style="font-size: 18pt" id='navIconMobile'></span>
                </button>
                <div class="text-white nav-title" style="margin-left: 10px;">
                    Achiever
                </div>
                <div class="p-2 flex-grow-1"></div>
            </nav>
        </div>
    </div>
</nav>

<script>
    var loggedIn = false; //global flag that signals if the user is signed in

    //When the page finished loading, adjust the navbar size
    $(document).ready(function () {
        resizeNav()
        setQueryParams()
        var userId = getQueryParam("userId") // store the current userID from the query parameters     
        if ("" !== userId && null !== userId && typeof userId !== 'undefined') { //if that userID is actually there, show that the user is logged in.
            loggedIn = true;
            setCurrentPageTitle();
        }
        else { //If there is no user ID, show that they are logged out.
            $('.logged-in').hide();
            $('.logged-out').show();
            disableMenu();
        }
    });

    // When the window resizes, we want to resize the navbar
    $(window).resize(resizeNav);

    /**
     * Handles the actions executed when switching between mobile and large resolutions
     */
    function resizeNav() {
        // If the window is scaled to mobile, use the hamburger navbar
        if ($(window).width() <= 640) {
            $(".nav-large").hide();
            $(".nav-smol").show();
        }
        // Otherwise, use the default nav bar with page tabs
        else {
            $(".nav-large").show();
            $(".nav-smol").hide();
        }
    }

    /**
     * Adds the query parameters needed for the rest of the app to the URL
     */
    function setQueryParams() {
        var url = window.location.href;
        var temp = url.split('userId=')[1]
        if(typeof temp === 'undefined') {
            return
        }
        var userId = url.split('userId=')[1].split('&')[0]
        $('.nav-link').attr('href', function (i, h) {
            return h + (h.indexOf('?') != -1 ? "&userId=" : "?userId=" + userId);
        });
    }

    /**
     * Grabs the value of a query parameter from the URL and returns its value
     * @param {string} param: name of the parameter that will be retrieved from the URL
     */
    function getQueryParam(param) {
        var url = window.location.href        
        temp = url.split(`${param}=`)[1]
        if(typeof temp === 'undefined') {
            return null
        }
        return url.split(`${param}=`)[1].split('&')[0]
    }

    /**
     * Sets the navbar title to the name of the current page.
     */
    function setCurrentPageTitle() {
        $('.nav-title').html(document.title);
    }

    /**
     * Disable the click events for the menu buttons.
     */
    function disableMenu() {
        $('.navbar-toggler').removeAttr('data-toggle')
        $("#navIconMobile").removeClass('fa-bars').addClass('fa-check-double')
    }
</script>