<!-- CptS 489, Spring 2019
     Project: Task Tracker
     File: schedule.html
     This file is responsible allowing the user to plan out time blocks to work on different tasks.
     These time blocks are separate from the due date, and encourage the user to work on their tasks in a timely mannner.
     This page displays a day view, where all the hours are mapped out and the user is able to select a time to schedule a task.
-->
<head>
    <base target="_top">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Import External stylesheets and libraries using 'CDN' (content delivery network) links: -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css"
        integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css"
        integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">

    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="../css/app.css">

    <script src="../js/model.js"></script>

    <script src="https://code.jquery.com/jquery-3.3.1.min.js"
        integrity="sha384-tsQFqpEReu7ZLhBV2VZlAu7zcOV+rXbYlF2cqB8txI/8aZajjp4Bqd+V6D5IgvKT" crossorigin="anonymous">
        </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js"
        integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous">
        </script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js"
        integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous">
        </script>
</head>

<body>
    <nav class="nav" id="navbar"></nav>

    <div id="tasks" class="container page-container">

        <div class='d-flex justify-content-between'>
            <h1 id="selectedDate">
            </h1>
            <button type="button" class="btn btn-secondary" id="prevDayBtn"
                style='margin-top:auto; margin-bottom: auto;'>
                <i class="fas fa-chevron-left"></i>&nbsp;
                Prev Day
            </button>
            <button type="button" class="btn btn-secondary" id="nextDayBtn"
                style='margin-top:auto; margin-bottom: auto;'>
                Next Day&nbsp;
                <i class="fas fa-chevron-right"></i>
            </button>
            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#timeblockEditModal"
                style='margin-top:auto; margin-bottom: auto;'>
                Schedule Timeblock
            </button>
        </div>

        <!-- Modal -->
        <div class="modal fade" id="timeblockEditModal" tabindex="-1" role="dialog"
            aria-labelledby="timeblockModalLabel" aria-hidden="true" style="margin: auto">
            <div class="vertical-alignment-helper">
                <div class="modal-dialog vertical-align-center" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3 class="modal-title" id="exampleModalLabel">Schedule A Task For A Time Block</h3>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form>
                                <span class="dropdown" style="float: right; width: 100%;">
                                    <button class="btn btn-secondary dropdown-toggle task-dropdown" type="button"
                                        id="taskDropdown" data-toggle="dropdown" aria-haspopup="true"
                                        aria-expanded="false" style="width: 100%">
                                        Select a task...
                                    </button>
                                    <div class="dropdown-menu" id="taskDropdownMenu"
                                        aria-labelledby="dropdownMenuButton"></div>
                                </span>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Discard</button>
                            <button type="button" class="btn btn-primary">Save</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <table style="width: 100%; margin-bottom: 64px;" cellpadding="2">
            <colgroup width="5%" valign="middle" span="1" align="center"></colgroup>
            <colgroup width="95%" valign="middle" span="1" align="center"></colgroup>
            <tbody>
                <tr bgcolor="#4dc3ff">
                    <th><h4>Hour</h4></th>
                    <th><h4>Tasks</h4></th>
                </tr>
            </tbody>
        </table>

    </div>
</body>

<script>
    //load the navbar when the page loads
    $(document).ready(function () {
        $("#navbar").load("navbar.html", function() {
            $("#nav-schedule").addClass("nav-active");
        });
        generateTableRows(); //generates tables for the whole 24 hour day
        loadModalDropdown();

        var today = new Date();
        $("#selectedDate").html(today.toDateString() + ":");
    });


    // Function to generate rows for a table to make it look like a calendar.
    // The table will have 24 hours (12AM-11PM) and be broken down into sections of 15 minutes.
    function generateTableRows() {
        var rowHTML = "";
        var time;
        var meridian = "AM";
        for (var i = 0; i < 24; i++) {
            time = (i % 12);
            if (time == 0)
                time = 12;
            if (i >= 12)
                meridian = "PM"

            rowHTML +=
                "<tr>" +
                "<td rowspan=\"4\" scope=\"row\"><span>" + time + ":00" + meridian + "</span></td>" +
                "<td class=\"empty-task-time\" id=\"time:" + i + ":00" + "\">&nbsp;</td>" +
                "</tr>" +
                "<tr><td class=\"empty-task-time\" id=\"time:" + i + ":15" + "\">&nbsp;</td></tr>" +
                "<tr><td class=\"empty-task-time\" id=\"time:" + i + ":30" + "\">&nbsp;</td></tr>" +
                "<tr><td class=\"empty-task-time\" id=\"time:" + i + ":45" + "\">&nbsp;</td></tr>";
        }
        $("tbody").append(rowHTML);
    }

    //event handler for when the user clicks on an empty time slot to add a task to.
    $(document.body).on("click", ".empty-task-time", function (e) {
        var id = e.target.id;
        var temp = id.split(':');
        var hour24 = temp[1];
        var quarter = temp[2];

        //TODO: input data to the modal related to what the user clicked on.

        $("#timeblockEditModal").modal("show"); //open the modal
    });

    // Event handler for when the time block editor is opened.
    function loadModalDropdown() {
        var tasks = getTaskList();
        var taskSelectHTML = "";

        tasks.forEach(task => {
            taskSelectHTML += "<a class='dropdown-item task-dropdown-item' id='task:" + task.id + "'>" + task.title + "</a>";
            console.log(task);
        });
        $("#taskDropdownMenu").html(taskSelectHTML);
    };

    // Event handler for when a task from the dropdown is clicked.
    // Updates the text of the dropdown to be the contents of the item that was clicked.
    $(document.body).on("click", ".task-dropdown-item", function (e) {
        $("#taskDropdown").html(e.target.innerHTML);
    });

</script>